<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
	body, ul, li{
		font-family: 'Microsoft yahei';
		margin: 0;
		padding: 0;
		font-size: 14px;
	}
	*{
		box-sizing: border-box;
	}
	ul,li{
		list-style: none;
		float: left;
		width: 100%;
	}
	ul.bookmarks{
		border-left: 4px solid #3da1ff;
		/*padding-left: 10px;*/
	}
	.bookmarks li{
		position: relative;
		border-bottom: 1px solid #ccc;
		padding: 5px;
		/*box-shadow: 0 0 0px #bbb;*/
		margin: 1px 0;
	}
	.bookmarks li:before{
		content: '';
		width: 10px;
		height: 10px;
		border-radius: 50%;
		position: absolute;
		background-color: #3da1ff;
		border: 2px solid #fff;
		left: -9px;
		top: 4px;
		box-shadow: 0 0 0px #555;
	}
	.left{
		width: 200px;
		background-color: #f7f7f7;
    	border-right: 2px solid #ccc;
		text-align: center;
		position: fixed;
		top: 0;
		left: 0;
		bottom: 0;
		right: 0;
	}
	.right{
		margin-left: 200px;
		padding: 10px;
	}
	.tag{
		/*width: 100%;*/
		float: left;
	}
	.tag div{
		display: inline-block;
		padding: 2px 5px;
		color: #fff;
		text-shadow: 1px 0 1px #000;
		background-color: #E6501E;
		float: left;
		font-size: 12px;
		margin-right: 10px;
		border-radius: 2px;

	}
	.title{
		float: left;
		margin: 0 20px;
		/*font-size: 14px;*/
	}
	.title a{
		color: #555;
		text-decoration: none;
	}
	.modal{
		position: fixed;
		top: -300px;
		background-color: #fff;
		box-shadow: 0 0 10px #aaa;
		border-radius: 5px;
		padding: 20px;
		transition: top 0.3s;
		width: 400px;
	}
	.modal>div{
		margin-bottom: 10px;
	}
	.modal>div>input{
		width: 100%;
	}


	.clearfix:after{
		content: '';
		display: table;
		clear: both;
	}
	.menu{
	    border-top: 1px solid #bbb;
	    padding-top: 4px;
	    width: 90%;
	    display: inline-block;
	    float: none;
	}
	.menu li a{
		text-decoration: none;
		color: #3da1ff;
		display: block;
		padding: 5px 0;
	}
	.menu li a:hover{
		background-color: #3da1ff;
		color: #fff;
	}
	</style>
</head>
<body>
	<div class="left">
		<img src="https://img.wdstatic.cn/console/images/logo-632b60596e.svg" width="150" style="margin: 20px 0;">
		<div>
			<ul class="menu">
				<li><a href="javascript:void(0)">Recently Used</a></li>
				<li><a href="javascript:void(0)">View By Tags</a></li>
			</ul>
			<ul class="menu">
				<li><a href="javascript:void(0)" onclick="showBmAdd()">Add Bookmark</a></li>
				<li><a href="javascript:void(0)" onclick="showTagAdd()">Add Tag</a></li>
			</ul>
		</div>
	</div>
	<div class="right clearfix">
		<ul id="bookmarks" class="bookmarks">no bookmarks.</ul>
	</div>

	<div class="modal" id="tagModal">
		<div>
			<b>Add tag</b>
		</div>
		<div>
			<label for="title">Name</label>
			<input type="text" id="tagName" name="title">
		</div>
		<div>
			<label for="url">Icon URL</label>
			<input type="url" id="tagIconUrl" name="url">
		</div>
		<div>
			<input type="submit" value="Submit" onclick="addTag()">
		</div>
		<div>
			<input type="button" value="Cancel" onclick="hideAdd(this.parentNode.parentNode)">
		</div>
	</div>
	<div class="modal" id="bookmarkModal">
		<div>
			<b>Add bookmark</b>
		</div>
		<div>
			<label for="title">Title</label>
			<input type="text" id="title" name="title">
		</div>
		<div>
			<label for="url">URL</label>
			<input type="url" id="url" name="url">
		</div>
		<div>
			<input type="submit" value="Submit" onclick="addBookmark()">
		</div>
		<div>
			<input type="button" value="Cancel" onclick="hideAdd(this.parentNode.parentNode)">
		</div>
	</div>
		
	<script src = "https://cdn.wilddog.com/sdk/js/2.5.2/wilddog.js"></script>
	<script>
		tagModal.style.left = bookmarkModal.style.left = (document.body.clientWidth - bookmarkModal.clientWidth) / 2 + 'px';
		function showBmAdd(){
			bookmarkModal.style.top = 0;
		}
		function showTagAdd(){
			tagModal.style.top = 0;
		}
		function hideAdd(element){
			element.style.top = -(10 + element.clientHeight) + 'px';
		}
		function addBookmark(){
			var date = new Date();
			var bookmark = {};
			bookmark = {
				'title': title.value,
				'url': url.value,
				'date': date
			};
			ref.child("bookmarks").push(bookmark, function(error){
				if(error){
					alert(error);
				}else{
					title.value = url.value = '';
					hideAdd(bookmarkModal);
					list();
				}
			});		
		}
		function addTag(){
			var tag =  {
				'name': tagName.value,
				'icon': tagIconUrl.value,
				'date': new Date()
			};
			ref.child("tags").push(tag, function(error){
				if(error){
					alert(error);
				}else{
					tagName.value = tagIconUrl.value = '';
					hideAdd(tagModal);
				}
			});		
		}

		var config = {
		  syncURL: "https://xkfront-5220.wilddogio.com" //输入节点 URL
		};
		wilddog.initializeApp(config);
		var ref = wilddog.sync().ref();


		// ref.update({
		//   "messageboard":{
		//     "message1":{
		//         "content" : "Wilddog, Cool!!!!!",
		//         "presenter" : "Jack"
		//     }
		//   }
		// });
		// ref.child("Jobs").set({
		//     "full_name": "Steve Jobs",
		//     "gender": "male"
		// }, function(error) {
		//     if (error == null){
		//         // alert('数据同步到野狗云端成功完成');
		//     }
		// });
		list();
		function list(){
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function(){
				if(xhr.readyState == 4){
					console.log(xhr.responseText);
					if(xhr.status == 200){
						var bms = JSON.parse(xhr.responseText), html = "";
						for(var b in bms){
							html += '<li>' +
								'<b class="title"><a href="' + bms[b].url + '" target="_blank">' + bms[b].title + '</a></b>' +
								'<div class="tag">' +
									'<div>nodejs</div>' +
									'<div>test</div>' +
								'</div>' +
							'</li>';
						}
						bookmarks.innerHTML = html;
					}
				}
			};
			xhr.open('GET', config.syncURL + '/bookmarks.json', true);
			xhr.send();
		}
	</script>
</body>
</html>